<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Canvas Drawing App</title>
  <link rel="stylesheet" href="main.css" />
</head>

<body>
    <!-- Canvas -->
    <canvas id="myCanvas" style="border: 2px solid #000; float: left;"></canvas>

    <!-- Main -->
    <main>
        <section class="colors">
        <input type="text" class="color-picker" value="#171717" />
        </section>
        <section class="thickness">
        <input type="number" class="stroke-weight" value="3" />
        </section>
        <button class="clear">X</button>

        <button type="button" id="btnDisplay">Display</button>
        <button type="button" id="btnDownload">Download</button><hr>

        <img src="" id="imgConverted" style="float: left; border: 2px solid #00f; margin-left: 10px">

    </main>

    <!-- Script Code -->
    <script>
        const clearButton = document.querySelector('.clear');
        const stroke_weight = document.querySelector('.stroke-weight');
        const color_picker = document.querySelector('.color-picker');

        const canvas = document.querySelector('#myCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;

        const btnDisplay = document.querySelector("#btnDisplay"); // Display button
        const btnDownload = document.querySelector("#btnDownload"); // Download button

        canvas.addEventListener('mousedown', start);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stop);

        clearButton.addEventListener('click', clearCanvas);

        function start (e) {
            isDrawing = true;
            draw(e);
        }

        function draw ({clientX: x, clientY: y}) {
            if (!isDrawing) return;
            ctx.lineWidth = stroke_weight.value;
            ctx.lineCap = "round";
            ctx.strokeStyle = color_picker.value;

            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function stop () {
            isDrawing = false;
            ctx.beginPath();
        }

        // Clear Canvas
        function clearCanvas () {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Set Canvas Size
        window.addEventListener('resize', resizeCanvas);
        function resizeCanvas () {
            canvas.width = 400;
            canvas.height = 400;
        }
        resizeCanvas();

        btnDisplay.addEventListener("click", function () {
           const dataURI = canvas.toDataURL();
           imgConverted.src = dataURI;
        });

        btnDownload.addEventListener("click", function() {
            if(window.navigator.msSaveBlob) {
                window.navigator.msSaveBlob(canvas.msToBlob(), "canvas-image.png");
            } else {    
                const a = document.createElement("a");

                document.body.appendChild(a);
                a.href = canvas.toDataURL();
                a.download = "canvas-image.png";
                a.click();
                document.body.removeChild(a);
            }
        });

    </script>
</body>
</html>